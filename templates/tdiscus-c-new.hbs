<!-- Flash messages -->
{{>> tdiscus-flash-messages.hbs }}

<!-- The New Discussion Modal -->
<div id="add-discussion-div" title="{{__ "New Discussion" }}" >
<form id="add-discussion-form">
<p>
<input type="submit" id="add-discussion-submit" value="{{__ '+ Discussion' }}" >
<input type="submit" id="add-discussion-cancel" value="{{__ 'Cancel' }}" 
onclick='window.location.href=addSession("{{ tsugi.rest_path.parent }}");return false;'
>
<span id="add-discussion-feedback"></span>
</p>
<p>{{__ "Title:" }} <br/>
<input type="text" name="title" class="form-control">
</p>
<p>{{__ "Description:" }} <br/>
<textarea id="editor" name="body" class="form-control">
</textarea>
</p>
</form>
</div>

<script>
    $('#add-discussion-submit').click(function(ev) {
        ev.preventDefault()
        for ( instance in CKEDITOR.instances )
            CKEDITOR.instances[instance].updateElement();
        var ser = $(ev.target.form).serialize();
        $('#add-discussion-feedback').empty().append('<img src="{{ tsugi.spinnerUrl }}">').show();
        $.post(addSession('{{ tsugi.rest_path.parent }}/api/add-discussion'), ser)
            .done( function(data) {
                // $('#add-discussion-feedback').hide();
                // $('#add-discussion-div').dialog('close');
                // $('#alert-success-text').empty().append('{{__ 'Success' }}');
                // $('#alert-success').show();
                window.location.href=addSession("{{ tsugi.rest_path.parent }}");
            })
            .error( function(xhr, status, error) {
                console.log(xhr);
                console.log(status);
                console.log(error);
                $('#add-discussion-feedback').empty()
                    .append('<span class="text-danger">{{__ 'Request Failed' }}</span>');
            });
    });

    // Replace the <textarea id="editor1"> with a CKEditor
    // instance, using default configuration.
    CKEDITOR.replace( 'editor' );
</script>
